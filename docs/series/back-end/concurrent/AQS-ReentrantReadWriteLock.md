---
title: AQS-ReentrantReadWriteLock
date: 2021/12/06
tags:
 - AQS
categories:
 - back-end
---
## 读写锁介绍

现实中的场景：对共享资源有读和写的操作，且写操作没有读操作那么频繁（读多写少）。在没有写操作的时候，多个线程同时读一个资源没有任何问题，所以应该允许多个线程同时读取共享资源（读读可以并发）；但是如果一个线程想去写这些共享资源，就不应该允许其他线程对该资源进行读和写操作了（读写，写读，写写互斥）。在读多于写的情况下，读写锁能够提供比排它锁更好的并发和吞吐量。



### 三个重要特性

* 公平选择性
* 可重入
* 锁降级



## 结构

类图

![](https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/20211218203915.png)



## 读写锁状态的设计

如何用一个变量维护多个独立的状态

按位分割

* 读锁：低16位
* 写锁：高16位
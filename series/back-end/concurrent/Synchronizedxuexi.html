<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.18">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>Synchronized学习 | Daily Notes</title><meta name="description" content="Just playing around">
    <link rel="preload" href="/daily-notes/assets/style-C2pV2qh2.css" as="style"><link rel="stylesheet" href="/daily-notes/assets/style-C2pV2qh2.css">
    <link rel="modulepreload" href="/daily-notes/assets/app-CtC7YmlN.js"><link rel="modulepreload" href="/daily-notes/assets/Synchronizedxuexi.html-Df7kNl8V.js">
    <link rel="prefetch" href="/daily-notes/assets/timeline.html-CoF9eKaj.js" as="script"><link rel="prefetch" href="/daily-notes/assets/posts.html-Dumrd_z2.js" as="script"><link rel="prefetch" href="/daily-notes/assets/friendship-link.html-BzDu-OeR.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html-Ni5XEFPm.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html-CxfRooHo.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html--OpsNGSS.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html-BMJGvhRp.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html-fA9Wrpdq.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html-B2M8dO8V.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html-CYpSOIoc.js" as="script"><link rel="prefetch" href="/daily-notes/assets/1.html-Ccl766M9.js" as="script"><link rel="prefetch" href="/daily-notes/assets/index.html-D7_FpZXg.js" as="script"><link rel="prefetch" href="/daily-notes/assets/test.html-BO4eW3OY.js" as="script"><link rel="prefetch" href="/daily-notes/assets/AQS-CountDownLatch.html-DikrH61_.js" as="script"><link rel="prefetch" href="/daily-notes/assets/Javadongtaidailideliangzhongshixian.html-Akyb-QKU.js" as="script"><link rel="prefetch" href="/daily-notes/assets/qianduanshiyonggongju.html-BDgwu9gH.js" as="script"><link rel="prefetch" href="/daily-notes/assets/qianduanxuanranfangan.html-Bw6jbrru.js" as="script"><link rel="prefetch" href="/daily-notes/assets/index.html-DHp8wE9V.js" as="script"><link rel="prefetch" href="/daily-notes/assets/index.html-DD8Q2GKJ.js" as="script"><link rel="prefetch" href="/daily-notes/assets/AQS-CountDownLatch.html-QKgiZx-E.js" as="script"><link rel="prefetch" href="/daily-notes/assets/AQS-ReentrantLock.html-D3psqMAJ.js" as="script"><link rel="prefetch" href="/daily-notes/assets/AQS-ReentrantReadWriteLock.html-yW4xXVRK.js" as="script"><link rel="prefetch" href="/daily-notes/assets/AQSxuexi.html-BcdKjpZf.js" as="script"><link rel="prefetch" href="/daily-notes/assets/Javabingfaanquanxuexi-01.html-BAvDPTth.js" as="script"><link rel="prefetch" href="/daily-notes/assets/Synchronizedzijiema.html-BGb8MDH9.js" as="script"><link rel="prefetch" href="/daily-notes/assets/index.html-C1i7WJRE.js" as="script"><link rel="prefetch" href="/daily-notes/assets/BigDecimalzuijiashijian.html-DyNg6voN.js" as="script"><link rel="prefetch" href="/daily-notes/assets/index.html-BdU7flhX.js" as="script"><link rel="prefetch" href="/daily-notes/assets/index.html-2G7V5Fbm.js" as="script"><link rel="prefetch" href="/daily-notes/assets/404.html-CgTR_Mzh.js" as="script"><link rel="prefetch" href="/daily-notes/assets/Valine.min-BeYqi7lJ.js" as="script"><link rel="prefetch" href="/daily-notes/assets/giscus-aTimukGI-CKTvSCx2.js" as="script"><link rel="prefetch" href="/daily-notes/assets/setupDevtools-7MC2TMWH-blv_ib-l.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container show-series show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/daily-notes/logo.png" alt="Daily Notes"><a href="/daily-notes/" class="site-name can-hide">Daily Notes</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/daily-notes/" class="link" aria-label="Home"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Home<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/daily-notes/posts.html" class="link" aria-label="Blog"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Blog<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title--active dropdown-link__title" type="button" aria-label="后端"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->后端<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="后端"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->后端<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/daily-notes/series/back-end/java/" class="link" aria-label="Java"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Java<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/back-end/concurrent/" class="link" aria-label="并发编程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->并发编程<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/back-end/spring/" class="link" aria-label="Spring"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Spring<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="前端"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->前端<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="前端"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->前端<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/daily-notes/series/front-end/react/" class="link" aria-label="React"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->React<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/front-end/javascript/" class="link" aria-label="JavaScript"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->JavaScript<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/front-end/javascript/" class="link" aria-label="TypeScript"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->TypeScript<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/front-end/vue/" class="link" aria-label="Vue"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Vue<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="服务端"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务端<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="服务端"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务端<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/daily-notes/series/server-end/db/" class="link" aria-label="DataBase"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->DataBase<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/server-end/docker/" class="link" aria-label="Docker"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docker<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/server-end/kubernetes/" class="link" aria-label="Kubernetes"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Kubernetes<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/daily-notes/series/server-end/jenkins/" class="link" aria-label="Jenkins"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Jenkins<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="读书笔记"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->读书笔记<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="读书笔记"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->读书笔记<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="Docs"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docs<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="Docs"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docs<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><header class="sub-navbar-container not-open"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><span></span><span></span><span></span></div> Series </span></header><!----><!----><div class="theme-main" style=""><aside class="series-container"><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->AQS<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/daily-notes/series/back-end/concurrent/AQSxuexi.html" class="link series-item series-item" aria-label="AQS学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->AQS学习<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/daily-notes/series/back-end/concurrent/AQS-CountDownLatch.html" class="link series-item series-item" aria-label="AQS-CountDownLatch"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->AQS-CountDownLatch<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/daily-notes/series/back-end/concurrent/AQS-ReentrantLock.html" class="link series-item series-item" aria-label="AQS-ReentrantLock"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->AQS-ReentrantLock<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/daily-notes/series/back-end/concurrent/AQS-ReentrantReadWriteLock.html" class="link series-item series-item" aria-label="AQS-ReentrantReadWriteLock"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->AQS-ReentrantReadWriteLock<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1 active"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->Synchronized<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html" class="router-link-active router-link-exact-active link router-link-active series-item series-item" aria-label="Synchronized学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Synchronized学习<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/daily-notes/series/back-end/concurrent/Synchronizedzijiema.html" class="link series-item series-item" aria-label="Synchronized字节码"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Synchronized字节码<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">Synchronized学习</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->iniconico<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2021/12/13<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/daily-notes/categories/back-end/1.html" class="">back-end</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/daily-notes/tags/Synchronized/1.html" class="">Synchronized</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h2 id="实现方式" tabindex="-1"><a class="header-anchor" href="#实现方式"><span>实现方式</span></a></h2><p>关键字 <code>Synchronized</code></p><ol><li>方法上</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">       counter<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>字节码文件</p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/20211215011530.png" alt=""></p><p>通过方法的<strong>访问标志</strong>区分 0x0029 的来源</p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/20211215011750.png" alt=""></p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/20211215012357.png" alt=""></p><ol start="2"><li>代码块中（锁对象）</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            counter<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>字节码文件</p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/20211215012144.png" alt=""></p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/20211215012305.png" alt=""></p><hr><h2 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h2><ol><li>Jvm指令：方法上（acc_synchronized）</li><li>代码块（monitorenter monitorexit）</li></ol><blockquote><p>Synchronized 是JVM 内置锁，基于 <strong>Monitor</strong> 实现的，依赖的底层操作系统的互斥原语 <strong>Mutex</strong> （互斥量），它是一个重量级锁，性能较低。当然，<strong>JVM内置锁在1.5之后版本做了重大的优化</strong>，如锁粗化（Lock Coarsening）、锁消除（Lock Elimination）、轻量级锁（Lightweight Locking）、偏向锁（Biased Locking）、自适应自旋（Adaptive Spinning）等技术来减少锁操作的开销，内置锁的并发性能已经基本与Lock持平。</p></blockquote><p>Java 虚拟机通过一个同步结构支持方法和方法中的指令序列的同步：<strong>monitor</strong></p><p>同步方法是通过方法中的 access_flag 中设置 ACC_SYNCHRONIZED 标志来实现的；同步代码块是通过 monitorenter 和 monitorexit 来实现。两个指令的执行是 JVM 通过调用操作系统的互斥原语 mutex 来实现的，被阻塞的线程会挂起，等待重新调度，会导致 “用户态和内核态” 两个态之间来回切换，对性能有较大影响。</p><hr><h2 id="monitor-管程-监视器" tabindex="-1"><a class="header-anchor" href="#monitor-管程-监视器"><span>Monitor 管程/监视器</span></a></h2><p>Monitor，直译为“监视器”，而操作系统领域一般翻译为“管程”。管程是指管理共享变量以及对共享变量操作的过程，让它们支持并发。在Java 1.5之前，Java语言提供的唯一并发语言就是管程，Java 1.5之后提供的SDK并发包也是以管程为基础的。除了Java之外，C/C++、C#等高级语言也都是支持管程的。synchronized关键字和wait()、notify()、notifyAll()这三个方法是Java中实现管程技术的组成部分。</p><h3 id="mesa模型" tabindex="-1"><a class="header-anchor" href="#mesa模型"><span>MESA模型</span></a></h3><p>在管程的发展史上，先后出现过三种不同的管程模型，分别是Hasen模型、Hoare模型和MESA模型。现在正在广泛使用的是MESA模型。下面我们便介绍MESA模型：</p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/23757.png" alt=""></p><p>管程中引入了条件变量的概念，而且每个条件变量都对应有一个等待队列。条件变量和等待队列的作用是解决线程之间的同步问题。</p><h3 id="java语言内置管程synchronized" tabindex="-1"><a class="header-anchor" href="#java语言内置管程synchronized"><span>Java语言内置管程synchronized</span></a></h3><p>Java 参考了 MESA 模型，语言内置的管程（synchronized）对 MESA 模型进行了精简。MESA 模型中，条件变量可以有多个，Java 语言内置的管程里只有一个条件变量。模型如下图所示。</p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/23785.png" alt=""></p><h3 id="monitor-机制在java中的实现" tabindex="-1"><a class="header-anchor" href="#monitor-机制在java中的实现"><span>Monitor 机制在Java中的实现</span></a></h3><p>java.lang.Object 类定义了 wait()，notify()，notifyAll() 方法，这些方法的具体实现，依赖于 ObjectMonitor 实现，这是 JVM 内部基于 C++ 实现的一套机制。</p><p>ObjectMonitor其主要数据结构如下（hotspot源码ObjectMonitor.hpp）：</p><div class="language-c++ line-numbers-mode" data-highlighter="prismjs" data-ext="c++" data-title="c++"><pre><code><span class="line">ObjectMonitor() {</span>
<span class="line">    _header       = NULL; //对象头  markOop</span>
<span class="line">    _count        = 0;  </span>
<span class="line">    _waiters      = 0,   </span>
<span class="line">    _recursions   = 0;   // 锁的重入次数 </span>
<span class="line">    _object       = NULL;  //存储锁对象</span>
<span class="line">    _owner        = NULL;  // 标识拥有该monitor的线程（当前获取锁的线程） </span>
<span class="line">    _WaitSet      = NULL;  // 等待线程（调用wait）组成的双向循环链表，_WaitSet是第一个节点</span>
<span class="line">    _WaitSetLock  = 0 ;    </span>
<span class="line">    _Responsible  = NULL ;</span>
<span class="line">    _succ         = NULL ;</span>
<span class="line">    _cxq          = NULL ; //多线程竞争锁会先存到这个单向链表中 （FILO栈结构）</span>
<span class="line">    FreeNext      = NULL ;</span>
<span class="line">    _EntryList    = NULL ; //存放在进入或重新进入时被阻塞(blocked)的线程 (也是存竞争锁失败的线程)</span>
<span class="line">    _SpinFreq     = 0 ;</span>
<span class="line">    _SpinClock    = 0 ;</span>
<span class="line">    OwnerIsThread = 0 ;</span>
<span class="line">    _previous_owner_tid = 0;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/24692.png" alt=""></p><blockquote><p>在获取锁时，是将当前线程插入到cxq的头部，而释放锁时，默认策略（QMode=0）是：如果EntryList为空，则将cxq中的元素按原有顺序插入到EntryList，并唤醒第一个线程，也就是当EntryList为空时，是后来的线程先获取锁。_EntryList不为空，直接从_EntryList中唤醒线程。</p></blockquote><p>锁对象通过 <strong>对象头</strong> 存储锁状态</p><hr><h2 id="对象的内存布局" tabindex="-1"><a class="header-anchor" href="#对象的内存布局"><span>对象的内存布局</span></a></h2><p>Hotspot虚拟机中，对象在内存中存储的布局可以分为三块区域：对象头（Header）、实例数据（Instance Data）和对齐填充（Padding）。</p><ul><li>对象头：比如 hash码，对象所属的年代，对象锁，锁状态标志，偏向锁（线程）ID，偏向时间，数组长度（数组对象才有）等。</li><li>实例数据：存放类的属性数据信息，包括父类的属性信息；</li><li>对齐填充：由于虚拟机要求 <strong>对象起始地址必须是8字节的整数倍</strong>。填充数据不是必须存在的，仅仅是为了字节对齐。</li></ul><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/23870.png" alt=""></p><p>思考：Object obj = new Object() 在 Java 中占多大内存？</p><h3 id="对象头详解" tabindex="-1"><a class="header-anchor" href="#对象头详解"><span>对象头详解</span></a></h3><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/23978.png" alt=""></p><p>HotSpot虚拟机的对象头包括：</p><ul><li>Mark Word</li></ul><p>用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等，这部分数据的长度在32位和64位的虚拟机中分别为32bit和64bit，官方称它为“Mark Word”。</p><ul><li>Klass Pointer</li></ul><p>对象头的另外一部分是klass类型指针，即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。 32位4字节，64位开启指针压缩或最大堆内存&lt;32g时4字节，否则8字节。jdk1.8默认开启指针压缩后为4字节，当在JVM参数中关闭指针压缩（-XX:-UseCompressedOops）后，长度为8字节。</p><ul><li>数组长度（只有数组对象有）</li></ul><p>如果对象是一个数组, 那在对象头中还必须有一块数据用于记录数组长度。 4字节</p><p>可以使用JOL工具查看对象的内存布局</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!-- 查看Java 对象布局、大小工具 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjdk.jol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jol-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectSizeTest</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果</p><div class="language-tex line-numbers-mode" data-highlighter="prismjs" data-ext="tex" data-title="tex"><pre><code><span class="line"> WARNING: Unable to attach Serviceability Agent. You can try again with escalated privileges. Two options: a) use -Djol.tryWithSudo=true to try with sudo; b) echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope</span>
<span class="line">java.lang.Object object internals:</span>
<span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span>
<span class="line">      0     4        (object header)                           01 00 00 00 (00000001 00000000 00000000 00000000) (1)</span>
<span class="line">      4     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span>
<span class="line">      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)</span>
<span class="line">     12     4        (loss due to the next object alignment)</span>
<span class="line">Instance size: 16 bytes</span>
<span class="line">Space losses: 0 bytes internal + 4 bytes external = 4 bytes total</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>OFFSET: 偏移地址，字节</li><li>SIZE: 占用的内存大小，字节</li><li>TYPE DESRIPTION: 类型描述，其中 object header 为对象头</li><li>VALUE: 对应内存中当前存储的值，二进制32位</li></ul><ol><li><p>利用jol查看64位系统java对象（空对象），默认开启指针压缩，总大小显示16字节，前12字节为对象头</p></li><li><p>关闭指针压缩后，对象头为16字节：// 关闭命令 -XX:-UseCompressedOops</p></li></ol><h3 id="锁状态位置" tabindex="-1"><a class="header-anchor" href="#锁状态位置"><span>锁状态位置</span></a></h3><p>锁状态被记录在每个对象的对象头的Mark Word中</p><p><strong>Mark Word是如何记录锁状态的</strong></p><p>Hotspot通过markOop类型实现Mark Word，具体实现位于markOop.hpp文件中。由于对象需要存储的运行时数据很多，考虑到虚拟机的内存使用，markOop被设计成一个非固定的数据结构，以便在极小的空间存储尽量多的数据，根据对象的状态复用自己的存储空间。</p><p>简单点理解就是：MarkWord 结构搞得这么复杂，是因为需要节省内存，让同一个内存区域在不同阶段有不同的用处。</p><p><strong>Mark Word的结构</strong></p><div class="language-c++ line-numbers-mode" data-highlighter="prismjs" data-ext="c++" data-title="c++"><pre><code><span class="line">//  32 bits:</span>
<span class="line">//  --------</span>
<span class="line">//             hash:25 ------------&gt;| age:4    biased_lock:1 lock:2 (normal object)</span>
<span class="line">//             JavaThread*:23 epoch:2 age:4    biased_lock:1 lock:2 (biased object)</span>
<span class="line">//             size:32 ------------------------------------------&gt;| (CMS free block)</span>
<span class="line">//             PromotedObject*:29 ----------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)</span>
<span class="line">//</span>
<span class="line">//  64 bits:</span>
<span class="line">//  --------</span>
<span class="line">//  unused:25 hash:31 --&gt;| unused:1   age:4    biased_lock:1 lock:2 (normal object)</span>
<span class="line">//  JavaThread*:54 epoch:2 unused:1   age:4    biased_lock:1 lock:2 (biased object)</span>
<span class="line">//  PromotedObject*:61 ---------------------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)</span>
<span class="line">//  size:64 -----------------------------------------------------&gt;| (CMS free block)</span>
<span class="line">//</span>
<span class="line">//  unused:25 hash:31 --&gt;| cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; normal object)</span>
<span class="line">//  JavaThread*:54 epoch:2 cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; biased object)</span>
<span class="line">//  narrowOop:32 unused:24 cms_free:1 unused:4 promo_bits:3 -----&gt;| (COOPs &amp;&amp; CMS promoted object)</span>
<span class="line">//  unused:21 size:35 --&gt;| cms_free:1 unused:7 ------------------&gt;| (COOPs &amp;&amp; CMS free block)</span>
<span class="line"></span>
<span class="line">。。。。。。</span>
<span class="line">//    [JavaThread* | epoch | age | 1 | 01]       lock is biased toward given thread</span>
<span class="line">//    [0           | epoch | age | 1 | 01]       lock is anonymously biased</span>
<span class="line">//</span>
<span class="line">//  - the two lock bits are used to describe three states: locked/unlocked and monitor.</span>
<span class="line">//</span>
<span class="line">//    [ptr             | 00]  locked             ptr points to real header on stack</span>
<span class="line">//    [header      | 0 | 01]  unlocked           regular object header</span>
<span class="line">//    [ptr             | 10]  monitor            inflated lock (header is wapped out)</span>
<span class="line">//    [ptr             | 11]  marked             used by markSweep to mark an object</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>hash： 保存对象的哈希码。运行期间调用System.identityHashCode()来计算，延迟计算，并把结果赋值到这里。</li><li>age： 保存对象的分代年龄。表示对象被GC的次数，当该次数到达阈值的时候，对象就会转移到老年代。</li><li>biased_lock： 偏向锁标识位。由于无锁和偏向锁的锁标识都是 01，没办法区分，这里引入一位的偏向锁标识位。</li><li>lock： 锁状态标识位。区分锁状态，比如11时表示对象待GC回收状态, 只有最后2位锁标识(11)有效。</li><li>JavaThread*： 保存持有偏向锁的线程ID。偏向模式的时候，当某个线程持有对象的时候，对象这里就会被置为该线程的ID。 在后面的操作中，就无需再进行尝试获取锁的动作。这个线程ID并不是JVM分配的线程ID号，和Java Thread中的ID是两个概念。</li><li>epoch： 保存偏向时间戳。偏向锁在CAS锁操作过程中，偏向性标识，表示对象更偏向哪个锁。</li></ul><p>32位JVM下的对象结构</p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/24022.png" alt=""></p><p>64位JVM下的对象结构</p><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/24028.png" alt=""></p><ul><li>ptr_to_lock_record：轻量级锁状态下，指向栈中锁记录的指针。当锁获取是无竞争时，JVM使用原子操作而不是OS互斥，这种技术称为轻量级锁定。在轻量级锁定的情况下，JVM通过CAS操作在对象的Mark Word中设置指向锁记录的指针。</li><li>ptr_to_heavyweight_monitor：重量级锁状态下，指向对象监视器Monitor的指针。如果两个不同的线程同时在同一个对象上竞争，则必须将轻量级锁定升级到Monitor以管理等待的线程。在重量级锁定的情况下，JVM在对象的ptr_to_heavyweight_monitor设置指向Monitor的指针</li></ul><hr><h2 id="synchronized中的锁" tabindex="-1"><a class="header-anchor" href="#synchronized中的锁"><span>Synchronized中的锁</span></a></h2><p>Mark Word中锁标记枚举类</p><div class="language-c++ line-numbers-mode" data-highlighter="prismjs" data-ext="c++" data-title="c++"><pre><code><span class="line">enum { locked_value             = 0,    //00 轻量级锁 </span>
<span class="line">         unlocked_value           = 1,   //001 无锁</span>
<span class="line">         monitor_value            = 2,   //10 监视器锁，也叫膨胀锁，也叫重量级锁</span>
<span class="line">         marked_value             = 3,   //11 GC标记</span>
<span class="line">         biased_lock_pattern      = 5    //101 偏向锁</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h3><p><img src="https://iniconico-image.oss-cn-chengdu.aliyuncs.com/typora/24018.png" alt=""></p><ol><li>无锁</li></ol><p>对象头标记 001</p><p>初始状态</p><ol start="2"><li>偏向锁</li></ol><p>对象头标记 101</p><p>不存在竞争，偏向某个线程，比如 t1，后续进入同步块的逻辑没有加锁解锁的开销</p><p>匿名偏向状态：未锁定，未偏向但是可偏向的对象：没有绑定ThreadId</p><p>偏向锁状态：绑定偏向线程的ThreadId</p><p><strong>偏向锁解锁 -&gt; 还是偏向锁</strong></p><ol start="3"><li>轻量级锁</li></ol><p>对象头标记 00</p><p>线程间存在轻微的竞争（线程交替执行，临界区逻辑简单）CAS获取锁，失败膨胀</p><ol start="4"><li>重量级锁</li></ol><p>对象头标记 10</p><p>多线程竞争激烈的场景，膨胀期间创建体格monitor对象 CAS自旋</p><p>重量级锁撤销 通过GC</p><h3 id="误区" tabindex="-1"><a class="header-anchor" href="#误区"><span>误区</span></a></h3><ol><li>无锁 -&gt; 偏向锁 -&gt; 轻量级锁 -&gt; 重量级锁 （不存在无锁 --&gt; 偏向锁）</li><li>轻量级锁自旋获取锁失败，会膨胀升级为重量级锁 （轻量级锁不存在自旋，CAS一次失败以后就膨胀了）</li><li>重量级锁不存在自旋（重量级锁自旋失败多次以后才会尝试去进行阻塞操作 park/unpark）</li></ol><h2 id="synchronized锁的优化" tabindex="-1"><a class="header-anchor" href="#synchronized锁的优化"><span>Synchronized锁的优化</span></a></h2><h3 id="针对偏向锁" tabindex="-1"><a class="header-anchor" href="#针对偏向锁"><span>针对偏向锁</span></a></h3><p>批量重偏向，批量撤销</p><p>从偏向锁的加锁解锁过程中可看出，当只有一个线程反复进入同步块时，偏向锁带来的性能开销基本可以忽略，但是当有其他线程尝试获得锁时，就需要等到safe point时，再将偏向锁撤销为无锁状态或升级为轻量级，会消耗一定的性能，所以在多线程竞争频繁的情况下，偏向锁不仅不能提高性能，还会导致性能下降。于是，就有了批量重偏向与批量撤销的机制。</p><h3 id="针对重量级锁" tabindex="-1"><a class="header-anchor" href="#针对重量级锁"><span>针对重量级锁</span></a></h3><p>自旋优化，自适应自旋</p><h3 id="锁粗化" tabindex="-1"><a class="header-anchor" href="#锁粗化"><span>锁粗化</span></a></h3><h3 id="锁消除" tabindex="-1"><a class="header-anchor" href="#锁消除"><span>锁消除</span></a></h3></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 1/12/2025, 5:27:01 AM<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasNext inner"><!----><span class="page-nav-item next">Synchronized字节码 → </span></p></nav><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#实现方式" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="实现方式"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->实现方式<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#原理" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="原理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->原理<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#monitor-管程-监视器" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Monitor 管程/监视器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Monitor 管程/监视器<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#mesa模型" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="MESA模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MESA模型<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#java语言内置管程synchronized" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Java语言内置管程synchronized"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Java语言内置管程synchronized<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#monitor-机制在java中的实现" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Monitor 机制在Java中的实现"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Monitor 机制在Java中的实现<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#对象的内存布局" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="对象的内存布局"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对象的内存布局<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#对象头详解" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="对象头详解"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对象头详解<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#锁状态位置" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="锁状态位置"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->锁状态位置<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#synchronized中的锁" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Synchronized中的锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Synchronized中的锁<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#概念" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="概念"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->概念<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#误区" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="误区"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->误区<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#synchronized锁的优化" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Synchronized锁的优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Synchronized锁的优化<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#针对偏向锁" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="针对偏向锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->针对偏向锁<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#针对重量级锁" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="针对重量级锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->针对重量级锁<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#锁粗化" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="锁粗化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->锁粗化<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/daily-notes/series/back-end/concurrent/Synchronizedxuexi.html#锁消除" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="锁消除"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->锁消除<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/daily-notes/assets/app-CtC7YmlN.js" defer></script>
  </body>
</html>
